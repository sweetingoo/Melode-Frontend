<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Debug - Melode Healthcare Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <!-- Configuration -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center" x-data="{
    loginForm: {
        email: '',
        password: '',
        mfa_token: '',
        remember_me: false
    },
    isLoading: false,
    debugInfo: '',
    
    async handleLogin() {
        this.isLoading = true;
        this.debugInfo = '';
        
        try {
            console.log('Login attempt:', this.loginForm);
            
            const response = await fetch(${window.getApiBaseUrl ? window.getApiBaseUrl() : 'http://127.0.0.1:8000/api/v1'}/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    email: this.loginForm.email,
                    password: this.loginForm.password,
                    mfa_token: this.loginForm.mfa_token || null
                })
            });
            
            console.log('Response status:', response.status);
            console.log('Response headers:', response.headers);
            
            const data = await response.json();
            console.log('Response data:', data);
            
            this.debugInfo = JSON.stringify(data, null, 2);
            
            if (response.ok) {
                // Store tokens
                localStorage.setItem('access_token', data.access_token);
                localStorage.setItem('refresh_token', data.refresh_token);
                localStorage.setItem('is_authenticated', 'true');
                
                if (data.user) {
                    localStorage.setItem('user_data', JSON.stringify(data.user));
                }
                
                alert('Login successful! Check console for details.');
            } else {
                alert('Login failed: ' + (data.detail || 'Unknown error'));
            }
            
        } catch (error) {
            console.error('Login error:', error);
            this.debugInfo = 'Error: ' + error.message;
            alert('Login failed: ' + error.message);
        } finally {
            this.isLoading = false;
        }
    }
}">
    <div class="max-w-md w-full space-y-8">
        <div>
            <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
                Login Debug
            </h2>
        </div>
        
        <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
            <form @submit.prevent="handleLogin" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" x-model="loginForm.email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" x-model="loginForm.password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                
                <div>
                    <button type="submit" :disabled="isLoading" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50">
                        <span x-show="!isLoading">Login</span>
                        <span x-show="isLoading">Logging in...</span>
                    </button>
                </div>
            </form>
            
            <div x-show="debugInfo" class="mt-6">
                <h3 class="text-lg font-medium text-gray-900 mb-2">Debug Info:</h3>
                <pre class="bg-gray-100 p-4 rounded text-sm overflow-auto" x-text="debugInfo"></pre>
            </div>
        </div>
    </div>
</body>
</html>
